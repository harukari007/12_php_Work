<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT API Integration</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .loader {
            display: none;
        }

        #result {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>ChatGPT API Integration</h1>
    <form id="apiForm">
        <label for="kachi_teian">Query:</label>
        <input type="text" id="kachi_teian" name="query" required>
        <input type="hidden" id="swflg" name="swflg" value="1">
        <button type="submit">Submit</button>
    </form>
    <div class="loader">Loading...</div>
    <div id="result"></div>

    <script>
        $("#apiForm").on("submit", function (e) {
            e.preventDefault();
            $(".loader").show();
            $("#result").empty();

            $.ajax({
                type: "POST",
                url: "search.php",
                data: { query: $("#kachi_teian").val(), swflg: $("#swflg").val() },
                dataType: "json",
                cache: false,
                success: function (data) {
                    $(".loader").hide();
                    if (data.error) {
                        $("#result").text("[Error] " + data.error);
                    } else {
                        let str = "";
                        let ar = data.response.split("。");
                        for (let i in ar) {
                            str += ar[i] ? ar[i] + "。" : "";
                        }
                        $("#result").html("<pre>" + str + "</pre>");
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $(".loader").hide();
                    $("#result").text("[Error] " + textStatus);
                }
            });
        });
    </script>
</body>

</html>